<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>S1P Support Ticket</title>

  <!-- Existing Outlook Add-in script (do NOT remove) -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>

  <!-- NEW: Teams SDK (safe to load even inside Outlook) -->
  <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f3f3f3;
      margin: 0;
      padding: 20px;
    }

    .card {
      background: #ffffff;
      border: 1px solid #d0d0d0;
      border-radius: 10px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    h3 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 22px;
      font-weight: 600;
      text-align: center;
      color: #1a1a1a;
    }

    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
      color: #333;
      font-size: 14px;
    }

    input, textarea, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
      background: #fafafa;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #0a65c2;
      outline: none;
      background: #fff;
    }

    button {
      background-color: #0078d4;
      color: white;
      font-size: 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      padding: 12px;
      font-weight: 600;
      margin-top: 10px;
    }

    button:hover {
      background-color: #005a9e;
    }

    .hidden { display: none; }

    .inline-hint {
      font-size: 14px;
      color: #444;
      margin-top: -6px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .attachment-note {
      margin-top: 12px;
      font-size: 14px;
      font-weight: 600;
      color: #0a65c2;
      text-align: center;
    }
  </style>
</head>

<body>

<div class="card">

  <h3>S1P Support Ticket</h3>

  <!-- DEPARTMENT -->
  <label for="department">Support Department:</label>
  <select id="department">
    <option value="">-- Select a support department --</option>
    <option value="IT">IT</option>
    <option value="CBO - Full Service">CBO - Full Service</option>
    <option value="Payor Relations">Payor Relations</option>
    <option value="RCM - Non Full Service">RCM - Non Full Service</option>
  </select>

  <!-- CATEGORY -->
  <label for="category">Category:</label>
  <select id="category">
    <option value="">-- Select a category --</option>
  </select>

  <!-- SUBCATEGORY -->
  <label id="subcategory-label" class="hidden" for="subcategory">Subcategory:</label>
  <select id="subcategory" class="hidden">
    <option value="">-- Select a subcategory --</option>
  </select>

  <!-- SUB-SUBCATEGORY -->
  <label id="subsubcategory-label" class="hidden" for="subsubcategory">Issue Type:</label>
  <select id="subsubcategory" class="hidden">
    <option value="">-- Select an issue type --</option>
  </select>

  <!-- CONTACT NAME -->
  <label for="contactName">Contact Name (Required):</label>
  <input id="contactName" placeholder="Your name" />

  <!-- WORKSTATION (IT only) -->
  <div id="ws-section" class="hidden">
    <label for="workstation">Workstation Name (Required for IT):</label>
    <input id="workstation" placeholder="e.g. FRONTDESK01, CLINICPC05" />
    <small class="inline-hint">
      Windows: Go to <strong>Settings &gt; System &gt; About</strong> and use the device name.
    </small>
  </div>

  <!-- CALLBACK -->
  <label for="callback">Callback Number (Required):</label>
  <input id="callback" placeholder="e.g. 555-123-4567" />

  <!-- LOCATION -->
  <label for="location">Location Code:</label>
  <input id="location" placeholder="e.g. END073, PO0806, OS0609" />

  <!-- DESCRIPTION -->
  <label for="description">Description:</label>
  <textarea id="description" rows="6" placeholder="Describe the issue in detail..."></textarea>

  <!-- SUBMIT -->
  <button id="submitBtn">Submit Ticket</button>

  <p class="attachment-note">
    After submitting, you’ll be able to attach screenshots or files in the next screen.
  </p>

</div>

<!-- Existing Outlook logic -->
<script src="taskpane.js"></script>

<!-- NEW: Add Teams + Outlook host detection bootstrap -->
<script>
  (function () {
    const isTeams = !!(window.microsoftTeams && microsoftTeams.app);

    if (isTeams) {
      // Initialize Teams — SAFE, DOES NOT AFFECT OUTLOOK
      microsoftTeams.app.initialize().then(() => {
        console.log("S1P Support: Running inside Microsoft Teams");

        // Tell Teams the tab is ready
        if (microsoftTeams.app.notifySuccess) {
          microsoftTeams.app.notifySuccess();
        }

        // Get Teams context (optional)
        microsoftTeams.app.getContext().then(ctx => {
          console.log("Teams Context:", ctx);
          // You can expose this to taskpane.js if needed
          window.s1pTeamsContext = ctx;
        });
      }).catch(err => {
        console.error("Teams initialization failed:", err);
      });

    } else if (window.Office && Office.onReady) {
      // Outlook Add-in (unchanged)
      Office.onReady().then(() => {
        console.log("S1P Support: Running inside Outlook add-in");
      });
    } else {
      console.log("S1P Support: Running as standalone webpage");
    }

  })();
</script>

</body>
</html>
